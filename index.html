<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Goonies Trip Map</title>

  <!-- Leaflet (map) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <style>
    :root{
      --ink:#2a1d12;
      --wax:#8b1c1c;
      --paper:#f1e3c6;
      --paper2:#e8d3a8;
      --shadow: rgba(0,0,0,.25);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--ink);
      background: radial-gradient(1200px 700px at 20% 10%, #2b2b2b 0%, #121212 55%, #0b0b0b 100%);
    }

    .wrap{
      max-width: 1100px;
      margin: 0 auto;
      padding: 18px;
    }

    header{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 14px;
    }

    .title{
      line-height:1.05;
    }
    .title h1{
      margin:0;
      font-size: clamp(22px, 3vw, 34px);
      letter-spacing:.5px;
    }
    .title .sub{
      opacity:.9;
      font-size: 14px;
      margin-top:6px;
    }

    .btnrow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    button{
      border:0;
      padding:10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 700;
      letter-spacing:.2px;
      box-shadow: 0 8px 20px var(--shadow);
      background: linear-gradient(180deg, #f7e8c9, #e3cfa5);
      color: var(--ink);
      transition: transform .08s ease;
    }
    button:active{ transform: translateY(1px); }
    button.secondary{
      background: linear-gradient(180deg, #1f1f1f, #121212);
      color: #f5e9d2;
      border: 1px solid rgba(255,255,255,.12);
    }

    .grid{
      display:grid;
      grid-template-columns: 1.4fr .6fr;
      gap:14px;
    }
    @media (max-width: 920px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      border-radius: 18px;
      overflow:hidden;
      box-shadow: 0 18px 45px var(--shadow);
      border: 1px solid rgba(255,255,255,.10);
    }

    /* “Treasure map” look: parchment + vignette */
    .mapShell{
      position:relative;
      background:
        radial-gradient(600px 320px at 20% 10%, rgba(255,255,255,.40), rgba(255,255,255,0) 55%),
        radial-gradient(700px 500px at 90% 0%, rgba(0,0,0,.25), rgba(0,0,0,0) 50%),
        linear-gradient(135deg, var(--paper), var(--paper2));
    }
    .mapShell::after{
      content:"";
      pointer-events:none;
      position:absolute; inset:0;
      background:
        radial-gradient(900px 520px at 50% 30%, rgba(0,0,0,0) 55%, rgba(0,0,0,.35) 100%),
        repeating-linear-gradient(0deg, rgba(0,0,0,.03), rgba(0,0,0,.03) 1px, rgba(0,0,0,0) 2px, rgba(0,0,0,0) 6px);
      mix-blend-mode:multiply;
      opacity:.55;
    }

    #map{
      height: 620px;
      width: 100%;
      filter: sepia(.55) contrast(1.05) saturate(.9);
    }
    @media (max-width: 920px){
      #map{ height: 520px; }
    }

    /* Sidebar */
    .side{
      background: linear-gradient(180deg, #f7ebd2, #e6d2ab);
      padding: 14px;
    }

    .legend{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-bottom: 10px;
      font-size: 13px;
      opacity:.95;
    }
    .dot{
      width:10px;height:10px;border-radius:50%;
      background: #2e7d32;
      box-shadow: 0 0 0 3px rgba(46,125,50,.18);
    }
    .dot.off{ background: #8b1c1c; box-shadow: 0 0 0 3px rgba(139,28,28,.18); }

    .listTitle{
      font-weight: 900;
      margin: 6px 0 10px;
      letter-spacing:.2px;
    }

    ul{
      list-style:none;
      padding:0;
      margin:0;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .spot{
      padding:10px 10px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.55);
      box-shadow: 0 10px 24px rgba(0,0,0,.12);
    }
    .spot .name{
      font-weight: 900;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .spot .meta{
      font-size: 12px;
      opacity:.9;
      margin-top: 4px;
    }
    .spot.visited{
      opacity:.8;
    }
    .spot.visited .name{
      text-decoration: line-through;
      text-decoration-thickness: 3px;
      text-decoration-color: rgba(139,28,28,.85);
    }

    .pill{
      font-size: 11px;
      font-weight: 900;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(0,0,0,.08);
      white-space:nowrap;
    }

    /* Custom marker icons (simple inline SVG look) */
    .markerLabel{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width: 30px;
      height: 30px;
      border-radius: 10px;
      font-weight: 1000;
      letter-spacing:.2px;
      box-shadow: 0 10px 25px rgba(0,0,0,.25);
      border: 1px solid rgba(0,0,0,.25);
      user-select:none;
    }
    .markerTodo{
      background: linear-gradient(180deg, #2f2f2f, #141414);
      color: #f7ebd2;
    }
    .markerDone{
      background: linear-gradient(180deg, #9a1f1f, #6f1414);
      color: #ffd9d9;
    }

    .footerNote{
      margin-top: 12px;
      font-size: 12px;
      opacity:.9;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>Goonies Trip Treasure Map</h1>
        <div class="sub">Click a pin to cross it off. Click again to un-cross. Progress saves on this device.</div>
      </div>
      <div class="btnrow">
        <button class="secondary" id="fitBtn">Fit Map to Pins</button>
        <button id="resetBtn">Reset Cross-Offs</button>
      </div>
    </header>

    <div class="grid">
      <div class="card mapShell">
        <div id="map" aria-label="Interactive map"></div>
      </div>

      <div class="card side">
        <div class="legend">
          <span class="dot"></span> Not crossed off
          <span class="dot off"></span> Crossed off
        </div>

        <div class="listTitle">Stops</div>
        <ul id="spotList"></ul>

        <div class="footerNote">
          Tip: If you want it to feel *more* like a movie treasure map, replace the basemap with a custom image overlay later.
          This version keeps everything real + clickable right away.
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- Locations (edit/add here) ---
    // NOTE: "id" must be unique. "lat/lng" are decimal degrees.
    const SPOTS = [
      {
        id: "goonies_house",
        name: "Goonies House",
        meta: "368 38th St, Astoria",
        lat: 46.19287,
        lng: -123.799666
      },
      {
        id: "oregon_film_museum",
        name: "Oregon Film Museum (Jail)",
        meta: "732 Duane St, Astoria",
        lat: 46.1885388,
        lng: -123.8353851
      },
      {
        id: "flavel_house",
        name: "Flavel House Museum",
        meta: "Goonies museum scenes (Astoria)",
        lat: 46.188137,
        lng: -123.835182
      },
      {
        id: "astoria_column",
        name: "Astoria Column",
        meta: "Coxcomb Hill viewpoint",
        lat: 46.18133,
        lng: -123.81756
      },
      {
        id: "peter_iredale",
        name: "Shipwreck of the Peter Iredale",
        meta: "Fort Stevens State Park",
        lat: 46.17837,
        lng: -123.98109
      },
      {
        id: "ecola_point",
        name: "Ecola Point",
        meta: "Ecola State Park overlook",
        lat: 45.9186,
        lng: -123.9775
      },
      {
        id: "indian_beach",
        name: "Indian Beach",
        meta: "Ecola State Park beach",
        lat: 45.9285,
        lng: -123.9779
      },
      {
        id: "haystack_rock",
        name: "Haystack Rock",
        meta: "Cannon Beach landmark",
        lat: 45.88438,
        lng: -123.96841
      }
    ];

    // --- Persistence ---
    const STORAGE_KEY = "goonies_trip_crossed_off_v1";
    const loadState = () => {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}"); }
      catch { return {}; }
    };
    const saveState = (state) => localStorage.setItem(STORAGE_KEY, JSON.stringify(state));

    let crossed = loadState(); // { [id]: true/false }

    // --- Map init ---
    const map = L.map("map", { zoomControl: true });

    // Basemap (real map) with a slightly “treasure map” filter applied via CSS
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 18,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // --- Custom marker icon factories ---
    const makeDivIcon = (isDone) => L.divIcon({
      className: "",
      html: `<span class="markerLabel ${isDone ? "markerDone" : "markerTodo"}">${isDone ? "✖" : "✦"}</span>`,
      iconSize: [30, 30],
      iconAnchor: [15, 15],
      popupAnchor: [0, -10]
    });

    const markersById = new Map();

    function setMarkerState(id, isDone){
      const marker = markersById.get(id);
      if (!marker) return;
      marker.setIcon(makeDivIcon(isDone));
    }

    function toggleCrossOff(id){
      crossed[id] = !crossed[id];
      saveState(crossed);
      setMarkerState(id, !!crossed[id]);
      renderList();
    }

    // --- Add markers ---
    const bounds = [];
    SPOTS.forEach(spot => {
      const isDone = !!crossed[spot.id];

      const marker = L.marker([spot.lat, spot.lng], {
        icon: makeDivIcon(isDone),
        title: spot.name
      }).addTo(map);

      marker.bindPopup(`
        <div style="font-weight:900;margin-bottom:4px;">${spot.name}</div>
        <div style="font-size:12px;opacity:.9;margin-bottom:8px;">${spot.meta}</div>
        <button
          style="border:0;padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:900;background:${isDone ? "#111" : "#8b1c1c"};color:#f7ebd2;"
          onclick="window.__toggle('${spot.id}')"
        >
          ${isDone ? "Un-cross" : "Cross off"}
        </button>
      `);

      marker.on("click", () => {
        // Just opening popup is fine; crossing happens via popup button.
        // If you want click-to-toggle immediately, uncomment next line:
        // toggleCrossOff(spot.id);
      });

      markersById.set(spot.id, marker);
      bounds.push([spot.lat, spot.lng]);
    });

    // Expose toggle for popup button onclick
    window.__toggle = (id) => toggleCrossOff(id);

    // Fit map to pins
    const fitToPins = () => map.fitBounds(bounds, { padding: [30, 30] });
    fitToPins();

    document.getElementById("fitBtn").addEventListener("click", fitToPins);

    document.getElementById("resetBtn").addEventListener("click", () => {
      crossed = {};
      saveState(crossed);
      SPOTS.forEach(s => setMarkerState(s.id, false));
      renderList();
    });

    // --- Sidebar list rendering ---
    function renderList(){
      const ul = document.getElementById("spotList");
      ul.innerHTML = "";

      SPOTS.forEach(spot => {
        const li = document.createElement("li");
        const done = !!crossed[spot.id];
        li.className = "spot" + (done ? " visited" : "");

        li.innerHTML = `
          <div class="name">
            <span>${spot.name}</span>
            <span class="pill">${done ? "CROSSED OFF" : "TO DO"}</span>
          </div>
          <div class="meta">${spot.meta}</div>
        `;

        li.addEventListener("click", () => {
          // Clicking list item centers map + toggles cross-off
          map.setView([spot.lat, spot.lng], Math.max(map.getZoom(), 13), { animate: true });
          toggleCrossOff(spot.id);
        });

        ul.appendChild(li);
      });
    }
    renderList();
  </script>
</body>
</html>
